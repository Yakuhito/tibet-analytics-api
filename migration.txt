To migrate from a v1 to a v2 database while preserving data, run the following queries:

```sql
-- Add new columns to the pairs table
ALTER TABLE pairs ADD COLUMN hidden_puzzle_hash VARCHAR(64);
ALTER TABLE pairs ADD COLUMN inverse_fee BIGINT;

-- Set default values for existing pairs
UPDATE pairs SET hidden_puzzle_hash = '' WHERE hidden_puzzle_hash IS NULL;
UPDATE pairs SET inverse_fee = 993 WHERE inverse_fee IS NULL;

-- Remove the network column from router table and add rcat column
ALTER TABLE router DROP COLUMN network;
ALTER TABLE router ADD COLUMN rcat BOOLEAN;

-- Set default value for rcat (assuming false for existing routers)
UPDATE router SET rcat = false WHERE rcat IS NULL;
```

To add USD price tracking to an existing v2 database, run the following queries:

```sql
-- Add USD trade volume column to pairs table
ALTER TABLE pairs ADD COLUMN trade_volume_usd VARCHAR DEFAULT '0';

-- Set default value for existing pairs
UPDATE pairs SET trade_volume_usd = '0' WHERE trade_volume_usd IS NULL;

-- Create the average USD price table
CREATE TABLE average_usd_price (
    from_timestamp BIGINT PRIMARY KEY NOT NULL UNIQUE,
    to_timestamp BIGINT NOT NULL,
    price_cents BIGINT NOT NULL
);

-- Create index on to_timestamp for faster queries
CREATE INDEX idx_average_usd_price_to_timestamp ON average_usd_price(to_timestamp);
```